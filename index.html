<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    #car {
      width: 50px;
      height: 50px;
      background-color: blue;
      position: absolute;
      top: 100px; // 将车辆的位置往下移一点，避免挡住按钮
    }
    #buttons {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }
    #speed {
      width: 50px;
      margin-left: 10px;
    }
    #distance {
      margin-top: 10px;
    }
    #auto-stop {
      background-color: gray;
    }
    #auto-stop.on {
      background-color: green;
    }
  </style>
  <title>可调速度火车模拟</title> <!-- 将标题改成火车相关的 -->
</head>
<body>

<div id="car"></div>

<div id="buttons">
  <button id="increase">加速</button>
  <button id="decrease">刹车</button>
  <button id="halt">停止</button> <!-- 将停止按钮放在刹车按钮旁边 -->
  <input id="speed" type="number" value="5" min="-100" max="100"> 米/秒 <!-- 将速度最大值改成100米/秒 -->
  <button id="auto-increase">自动加速</button>
  <button id="auto-decrease">自动减速</button>
  <button id="stop">关闭</button>
  <button id="auto-stop">自动停止</button>
  <button id="reset">回位</button> <!-- 添加一个回位按钮，直接把路程长度变为0 -->
  <input id="delta" type="number" value="0.1" min="-1" max="1"> 米/秒/帧
  <span id="status">当前状态：无</span>
</div>

<div id="distance">火车路程长度：0 米</div> <!-- 将位移长度的文本改成火车相关的 -->

<script>
  let car = document.getElementById('car');
  let increase = document.getElementById('increase');
  let decrease = document.getElementById('decrease');
  let speed = document.getElementById('speed');
  let autoIncrease = document.getElementById('auto-increase');
  let autoDecrease = document.getElementById('auto-decrease');
  let stop = document.getElementById('stop');
  let autoStop = document.getElementById('auto-stop');
  let halt = document.getElementById('halt'); // 获取停止按钮的元素
  let reset = document.getElementById('reset'); // 获取回位按钮的元素
  let delta = document.getElementById('delta');
  let status = document.getElementById('status');
  let distance = document.getElementById('distance');
  let speedValue = 5; // 初始速度，可以根据需要调整
  let distanceValue = 0; // 初始位移，可以根据需要调整
  let autoMode = false; // 是否开启自动模式
  let autoDirection = 0; // 自动模式的方向，1表示加速，-1表示减速，0表示无
  let autoStopMode = false; // 是否开启自动停止功能

  // 设定像素和米之间的比例，比如说，一个像素代表多少米
  // 这个比例可以根据你的需要调整，但是要注意，如果比例太大或太小，可能会导致车辆的移动速度过快或过慢，或者超出屏幕的范围
  let pixelToMeter = 0.01; // 这里假设一个像素代表0.01米，即100像素代表1米

  // 设定帧和秒之间的比例，比如说，一帧代表多少秒
  // 这个比例可以根据你的需要调整，但是要注意，如果比例太大或太小，可能会导致车辆的移动速度过快或过慢，或者超出屏幕的范围
  let frameToSecond = 0.02; // 这里假设一帧代表0.02秒，即50帧代表1秒

  function moveCar() {
    // 根据速度值和比例，计算每一帧车辆移动的像素数
    let pixelPerFrame = speedValue * frameToSecond / pixelToMeter;
    let leftPosition = car.offsetLeft + pixelPerFrame;
    car.style.left = leftPosition + 'px';

    // 检查是否超出边界，这里简单处理，你可以根据需要调整
    if (leftPosition > window.innerWidth) {
      car.style.left = '0px';
    }

    // 更新路程长度，根据比例，将像素转换为米
    // 如果车辆向右移动，路程长度增加，如果车辆向左移动，路程长度减少
    distanceValue += pixelPerFrame * pixelToMeter;
    distance.textContent = '火车路程长度：' + distanceValue.toFixed(2) + ' 米';

    // 如果开启了自动模式，根据方向和幅度，改变速度值
    if (autoMode) {
      speedValue += autoDirection * Number(delta.value);
      // 限制速度的范围，避免速度过大或过小
      if (speedValue > 100) {
        speedValue = 100;
      }
      if (speedValue < -100) {
        speedValue = -100;
      }
      // 更新速度输入框的值
      speed.value = speedValue;

      // 如果开启了自动停止功能，并且速度值在-0.5到0.5米/秒之间，就停止自动模式，并将方向设为无，并点击关闭按钮
      if (autoStopMode && speedValue >= -0.5 && speedValue <= 0.5) {
        autoMode = false;
        autoDirection = 0;
        status.textContent = '当前状态：无';
        stop.click(); // 调用关闭按钮
      }
    }

    requestAnimationFrame(moveCar);
  }

  // 启动车辆移动
  moveCar();

  // 可以通过修改speedValue变量来调整速度
  // 例如，将速度调整为10：speedValue = 10;

  // 添加一个事件监听器，当用户点击页面上的加速或刹车按钮时，改变速度
  increase.addEventListener('click', function() {
    speedValue += 1;
    // 限制速度的范围，避免速度过大或过小
    if (speedValue > 100) {
      speedValue = 100;
    }
    // 更新速度输入框的值
    speed.value = speedValue;
  });

  decrease.addEventListener('click', function() {
    speedValue -= 1;
    // 限制速度的范围，避免速度过大或过小
    if (speedValue < -100) {
      speedValue = -100;
    }
    // 更新速度输入框的值
    speed.value = speedValue;
  });

  // 添加一个事件监听器，当用户在速度输入框中输入值时，改变速度
  speed.addEventListener('change', function() {
    speedValue = Number(speed.value);
    // 限制速度的范围，避免速度过大或过小
    if (speedValue > 100) {
      speedValue = 100;
    }
    if (speedValue < -100) {
      speedValue = -100;
    }
    // 更新速度输入框的值
    speed.value = speedValue;
  });

  // 添加一个事件监听器，当用户点击页面上的自动加速或自动减速按钮时，切换自动模式，并改变方向
  autoIncrease.addEventListener('click', function() {
        // 如果当前是自动减速模式，就切换为自动加速模式
    if (autoMode && autoDirection == -1) {
      autoDirection = 1;
      status.textContent = '当前状态：自动加速';
    } else if (!autoMode) {
      // 否则，如果当前是无模式，就开启自动加速模式
      autoMode = true;
      autoDirection = 1;
      status.textContent = '当前状态：自动加速';
    }
  });

  autoDecrease.addEventListener('click', function() {
    // 如果当前是自动加速模式，就切换为自动减速模式
    if (autoMode && autoDirection == 1) {
      autoDirection = -1;
      status.textContent = '当前状态：自动减速';
    } else if (!autoMode) {
      // 否则，如果当前是无模式，就开启自动减速模式
      autoMode = true;
      autoDirection = -1;
      status.textContent = '当前状态：自动减速';
    }
  });

  // 添加一个事件监听器，当用户点击页面上的关闭按钮时，停止自动模式，并将方向设为无
  stop.addEventListener('click', function() {
    autoMode = false;
    autoDirection = 0;
    status.textContent = '当前状态：无';
  });

  // 添加一个事件监听器，当用户点击页面上的自动停止按钮时，开启或关闭自动停止功能
  autoStop.addEventListener('click', function() {
    // 如果当前是开启状态，就关闭自动停止功能，并将按钮颜色设为灰色
    if (autoStopMode) {
      autoStopMode = false;
      autoStop.classList.remove('on');
    } else {
      // 否则，就开启自动停止功能，并将按钮颜色设为绿色
      autoStopMode = true;
      autoStop.classList.add('on');
    }
  });

  // 添加一个事件监听器，当用户点击页面上的停止按钮时，直接把速度值设为0
  halt.addEventListener('click', function() {
    speedValue = 0;
    // 更新速度输入框的值
    speed.value = speedValue;
  });

  // 添加一个事件监听器，当用户点击页面上的回位按钮时，直接把路程长度设为0，并将车辆位置重置
  reset.addEventListener('click', function() {
    distanceValue = 0;
    // 更新路程长度的文本
    distance.textContent = '火车路程长度：' + distanceValue.toFixed(2) + ' 米';
    // 将车辆位置重置为初始值
    car.style.left = '0px';
  });
</script>

</body>
</html>