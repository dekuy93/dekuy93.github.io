<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    #car {
      width: 50px;
      height: 50px;
      background-color: blue;
      position: absolute;
      top: 100px; // 将车辆的位置往下移一点，避免挡住按钮
    }
    #buttons {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }
    #speed {
      width: 50px;
      margin-left: 10px;
    }
    #distance {
      margin-top: 10px;
    }
    #auto-stop {
      background-color: gray;
    }
    #auto-stop.on {
      background-color: green;
    }
  </style>
  <title>可调速度火车模拟</title> <!-- 将标题改成火车相关的 -->
</head>
<body>

<div id="car"></div>

<div id="buttons">
  <button id="increase">加速</button>
  <button id="decrease">刹车</button>
  <button id="halt">停止</button> <!-- 将停止按钮放在刹车按钮旁边 -->
  <input id="speed" type="number" value="5" min="-100" max="100"> 米/秒 <!-- 将速度最大值改成100米/秒 -->
  <button id="auto-increase">自动加速</button>
  <button id="auto-decrease">自动减速</button>
  <button id="stop">关闭</button>
  <button id="auto-stop">自动停止</button>
  <button id="reset">回位</button> <!-- 添加一个回位按钮，直接把路程长度变为0 -->
  <button id="start">开始位置</button> <!-- 添加一个开始位置按钮，让用户输入出发位置的路程长度和出发速度 -->
  <button id="end">结束位置</button> <!-- 添加一个结束位置按钮，让用户输入停止位置的路程长度 -->
  <button id="go">开始</button> <!-- 添加一个开始按钮，让用户开始定点减速停止功能 -->
  <input id="delta" type="number" value="0.1" min="-1" max="1"> 米/秒/帧
  <span id="status">当前状态：无</span>
</div>

<div id="distance">火车路程长度：0 米</div> <!-- 将位移长度的文本改成火车相关的 -->

<script>
  let car = document.getElementById('car');
  let increase = document.getElementById('increase');
  let decrease = document.getElementById('decrease');
  let speed = document.getElementById('speed');
  let autoIncrease = document.getElementById('auto-increase');
  let autoDecrease = document.getElementById('auto-decrease');
  let stop = document.getElementById('stop');
  let autoStop = document.getElementById('auto-stop');
  let halt = document.getElementById('halt'); // 获取停止按钮的元素
  let reset = document.getElementById('reset'); // 获取回位按钮的元素
  let start = document.getElementById('start'); // 获取开始位置按钮的元素
  let end = document.getElementById('end'); // 获取结束位置按钮的元素
  let go = document.getElementById('go'); // 获取开始按钮的元素
  let delta = document.getElementById('delta');
  let status = document.getElementById('status');
  let distance = document.getElementById('distance');
  let speedValue = 5; // 初始速度，可以根据需要调整
  let distanceValue = 0; // 初始位移，可以根据需要调整
  let autoMode = false; // 是否开启自动模式
  let autoDirection = 0; // 自动模式的方向，1表示加速，-1表示减速，0表示无
  let autoStopMode = false; // 是否开启自动停止功能
  let decelerateMode = false; // 是否开启定点减速停止功能
  let startDistance = 0; // 出发位置的路程长度
  let stopDistance = 0; // 停止位置的路程长度
  let startSpeed = 0; // 出发位置的速度

  // 设定像素和米之间的比例，比如说，一个像素代表多少米
  // 这个比例可以根据你的需要调整，但是要注意，如果比例太大或太小，可能会导致车辆的移动速度过快或过慢，或者超出屏幕的范围
  let pixelToMeter = 0.01; // 这里假设一个像素代表0.01米，即100像素代表1米

  // 设定帧和秒之间的比例，比如说，一帧代表多少秒
  // 这个比例可以根据你的需要调整，但是要注意，如果比例太大或太小，可能会导致车辆的移动速度过快或过慢，或者超出屏幕的范围
  let frameToSecond = 0.02; // 这里假设一帧代表0.02秒，即50帧代表1秒

  function moveCar() {
    // 根据速度值和比例，计算每一帧车辆移动的像素数
    let pixelPerFrame = speedValue * frameToSecond / pixelToMeter;
    let leftPosition = car.offsetLeft + pixelPerFrame;
    car.style.left = leftPosition + 'px';

    // 检查是否超出边界，这里简单处理，你可以根据需要调整
    if (leftPosition > window.innerWidth) {
      car.style.left = '0px';
    }

    // 更新路程长度，根据比例，将像素转换为米
    // 如果车辆向右移动，路程长度增加，如果车辆向左移动，路程长度减少
    distanceValue += pixelPerFrame * pixelToMeter;
    distance.textContent = '火车路程长度：' + distanceValue.toFixed(2) + ' 米';

    // 如果开启了自动模式，根据方向和幅度，改变速度值
    if (autoMode) {
      speedValue += autoDirection * Number(delta.value);
      // 限制速度的范围，避免速度过大或过小
      if (speedValue > 100) {
        speedValue = 100;
      }
      if (speedValue < -100) {
        speedValue = -100;
      }
      // 更新速度输入框的值
      speed.value = speedValue;

      // 如果开启了自动停止功能，并且速度值在-0.5到0.5米/秒之间，就停止自动模式，并将方向设为无，并点击关闭按钮
      if (autoStopMode && speedValue >= -0.5 && speedValue <= 0.5) {
        autoMode = false;
        autoDirection = 0;
        status.textContent = '当前状态：无';
        stop.click(); // 调用关闭按钮
      }
    }

    // 如果开启了定点减速停止功能，根据出发位置，停止位置，和出发速度，计算减速的幅度，并逐渐减速，直到到达停止位置
    if (decelerateMode) {
            // 计算减速的幅度，根据公式：v^2 = v0^2 - 2ad
      // 其中，v是当前速度，v0是出发速度，a是减速度，d是路程差
      // 解出a，得到：a = (v0^2 - v^2) / (2d)
      // 这里，我们假设路程差d是出发位置和停止位置之间的距离，即stopDistance - startDistance
      // 为了保证减速的方向和速度的方向一致，我们取绝对值
      let deceleration = Math.abs((startSpeed * startSpeed - speedValue * speedValue) / (2 * (stopDistance - startDistance)));
      // 根据减速度和帧数，计算每一帧速度变化的值
      let speedChange = deceleration * frameToSecond;
      // 根据速度的方向，改变速度值
      if (speedValue > 0) {
        speedValue -= speedChange;
      } else if (speedValue < 0) {
        speedValue += speedChange;
      }
      // 限制速度的范围，避免速度过大或过小
      if (speedValue > 100) {
        speedValue = 100;
      }
      if (speedValue < -100) {
        speedValue = -100;
      }
      // 更新速度输入框的值
      speed.value = speedValue;

      // 如果速度值接近于0，并且路程长度接近于停止位置，就停止定点减速停止功能，并点击关闭按钮
      if (Math.abs(speedValue) < 0.1 && Math.abs(distanceValue - stopDistance) < 0.1) {
        decelerateMode = false;
        speedValue = 0;
        distanceValue = stopDistance;
        // 更新速度输入框和路程长度的值
        speed.value = speedValue;
        distance.textContent = '火车路程长度：' + distanceValue.toFixed(2) + ' 米';
        // 将车辆位置设为停止位置
        car.style.left = stopDistance / pixelToMeter + 'px';
        stop.click(); // 调用关闭按钮
      }
    }

    requestAnimationFrame(moveCar);
  }

  // 启动车辆移动
  moveCar();

  // 可以通过修改speedValue变量来调整速度
  // 例如，将速度调整为10：speedValue = 10;

  // 添加一个事件监听器，当用户点击页面上的加速或刹车按钮时，改变速度
  increase.addEventListener('click', function() {
    speedValue += 1;
    // 限制速度的范围，避免速度过大或过小
    if (speedValue > 100) {
      speedValue = 100;
    }
    // 更新速度输入框的值
    speed.value = speedValue;
  });

  decrease.addEventListener('click', function() {
    speedValue -= 1;
    // 限制速度的范围，避免速度过大或过小
    if (speedValue < -100) {
      speedValue = -100;
    }
    // 更新速度输入框的值
    speed.value = speedValue;
  });

  // 添加一个事件监听器，当用户在速度输入框中输入值时，改变速度
  speed.addEventListener('change', function() {
    speedValue = Number(speed.value);
    // 限制速度的范围，避免速度过大或过小
    if (speedValue > 100) {
      speedValue = 100;
    }
    if (speedValue < -100) {
      speedValue = -100;
    }
    // 更新速度输入框的值
    speed.value = speedValue;
  });

  // 添加一个事件监听器，当用户点击页面上的自动加速或自动减速按钮时，切换自动模式，并改变方向
  autoIncrease.addEventListener('click', function() {
    // 如果当前是自动减速模式，就切换为自动加速模式
    if (autoMode && autoDirection == -1) {
      autoDirection = 1;
      status.textContent = '当前状态：自动加速';
    } else if (!autoMode) {
      // 否则，如果当前是无模式，就开启自动加速模式
      autoMode = true;
      autoDirection = 1;
      status.textContent = '当前状态：自动加速';
    }
  });

  autoDecrease.addEventListener('click', function() {
    // 如果当前是自动加速模式，就切换为自动减速模式
    if (autoMode && autoDirection == 1) {
      autoDirection = -1;
      status.textContent = '当前状态：自动减速';
    } else if (!autoMode) {
      // 否则，如果当前是无模式，就开启自动减速模式
      autoMode = true;
      autoDirection = -1;
      status.textContent = '当前状态：自动减速';
    }
  });

  // 添加一个事件监听器，当用户点击页面上的关闭按钮时，停止自动模式，并将方向设为无
  stop.addEventListener('click', function() {
    autoMode = false;
    autoDirection = 0;
    status.textContent = '当前状态：无';
  });

  // 添加一个事件监听器，当用户点击页面上的自动停止按钮时，开启或关闭自动停止功能
  autoStop.addEventListener('click', function() {
    // 如果当前是开启状态，就关闭自动停止功能，并将按钮颜色设为灰色
    if (autoStopMode) {
      autoStopMode = false;
      autoStop.classList.remove('on');
    } else {
      // 否则，就开启自动停止功能，并将按钮颜色设为绿色
      autoStopMode = true;
      autoStop.classList.add('on');
    }
  });

  // 添加一个事件监听器，当用户点击页面上的停止按钮时，直接把速度值设为0
  halt.addEventListener('click', function() {
    speedValue = 0;
    // 更新速度输入框的值
    speed.value = speedValue;
  });

  // 添加一个事件监听器，当用户点击页面上的回位按钮时，直接把路程长度设为0，并将车辆位置重置
  reset.addEventListener('click', function() {
    distanceValue = 0;
    // 更新路程长度的文本
    distance.textContent = '火车路程长度：' + distanceValue.toFixed(2) + ' 米';
    // 将车辆位置重置为初始值
    car.style.left = '0px';
  });

  // 添加一个事件监听器，当用户点击页面上的开始位置按钮时，让用户输入出发位置的路程长度和出发速度
  start.addEventListener('click', function() {
    // 获取用户输入的出发位置的路程长度和出发速度
    startDistance = Number(prompt('请输入出发位置的路程长度（单位：米）'));
    startSpeed = Number(prompt('请输入出发位置的速度（单位：米/秒）'));
    // 限制用户输入的范围，避免出现无效或异常的值
    if (isNaN(startDistance) || isNaN(startSpeed)) {
      alert('请输入有效的数字');
      return;
    }
    if (startDistance < 0) {
      alert('请输入非负的路程长度');
      return;
    }
    if (Math.abs(startSpeed) > 100) {
      alert('出发位置的速度不能超过100米/秒');
      return;
    }
    // 将速度值设为出发速度，将路程长度设为出发位置
    speedValue = startSpeed;
    distanceValue = startDistance;
    // 更新速度输入框和路程长度的值
    speed.value = speedValue;
    distance.textContent = '火车路程长度：' + distanceValue.toFixed(2) + ' 米';
    // 将车辆位置设为出发位置
    car.style.left = startDistance / pixelToMeter + 'px';
  });

  // 添加一个事件监听器，当用户点击页面上的结束位置按钮时，让用户输入停止位置的路程长度
  end.addEventListener('click', function() {
        // 获取用户输入的停止位置的路程长度
    stopDistance = Number(prompt('请输入停止位置的路程长度（单位：米）'));
    // 限制用户输入的范围，避免出现无效或异常的值
    if (isNaN(stopDistance)) {
      alert('请输入有效的数字');
      return;
    }
    if (stopDistance < 0) {
      alert('请输入非负的路程长度');
      return;
    }
    if (stopDistance < startDistance) {
      alert('停止位置的路程长度不能小于开始位置的路程长度');
      return;
    }
  });

  // 添加一个事件监听器，当用户点击页面上的开始按钮时，开启定点减速停止功能
  go.addEventListener('click', function() {
    // 开启定点减速停止功能
    decelerateMode = true;
  });
</script>

</body>
</html>