<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* 设置车辆的样式，包括宽度，高度，颜色，位置等 */
    #car {
      width: 50px;
      height: 50px;
      background-color: blue;
      position: absolute;
      top: 100px; /* 将车辆的位置往下移一点，避免挡住按钮 */
    }
    /* 设置按钮的样式，包括排列方式，间距等 */
    #buttons {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }
    /* 设置速度输入框的样式，包括宽度，间距等 */
    #speed {
      width: 50px;
      margin-left: 10px;
    }
    /* 设置路程长度的样式，包括间距等 */
    #distance {
      margin-top: 10px;
    }
    /* 设置自动停止按钮的样式，包括颜色等 */
    #auto-stop {
      background-color: gray;
    }
    /* 设置自动停止按钮开启时的样式，包括颜色等 */
    #auto-stop.on {
      background-color: green;
    }
    /* 设置站点的样式，包括宽度，高度，颜色，字体，隐藏等 */
    #station {
      width: 50px;
      height: 50px;
      background-color: lime;
      position: absolute;
      top: 50px;
      font-size: 20px;
      text-align: center;
      line-height: 50px;
      display: none;
    }
  </style>
  <title>可调速度火车模拟</title> <!-- 将标题改成火车相关的 -->
</head>
<body>

<div id="car"></div>

<div id="buttons">
  <button id="increase">加速</button>
  <button id="decrease">刹车</button>
  <button id="halt">停止</button> <!-- 将停止按钮放在刹车按钮旁边 -->
  <input id="speed" type="number" value="5" min="-100" max="100"> 米/秒 <!-- 将速度最大值改成100米/秒 -->
  <button id="auto-increase">自动加速</button>
  <button id="auto-decrease">自动减速</button>
  <button id="stop">关闭</button>
  <button id="auto-stop">自动停止</button>
  <button id="simulate">模拟到站</button> <!-- 添加一个模拟到站的按钮 -->
  <button id="reset">回位</button> <!-- 添加一个回位按钮，直接把路程长度变为0 -->
  <input id="end-position" type="number" value="100" min="0" max="1000"> 米 <!-- 添加一个结束位置的输入框，让用户可以设置火车要到达的路程长度 -->
  <input id="delta" type="number" value="0.1" min="-1" max="1"> 米/秒/帧
  <span id="status">当前状态：无</span>
</div>

<div id="distance">火车路程长度：0 米</div> <!-- 将位移长度的文本改成火车相关的 -->

<div id="station">站点</div> <!-- 添加一个站点的元素，用来表示火车到站的位置 -->

<script>
  // 获取页面上的元素，用来操作或显示
  let car = document.getElementById('car');
  let increase = document.getElementById('increase');
  let decrease = document.getElementById('decrease');
  let speed = document.getElementById('speed');
  let autoIncrease = document.getElementById('auto-increase');
  let autoDecrease = document.getElementById('auto-decrease');
  let stop = document.getElementById('stop');
  let autoStop = document.getElementById('auto-stop');
  let halt = document.getElementById('halt'); // 获取停止按钮的元素
  let reset = document.getElementById('reset'); // 获取回位按钮的元素
  let simulate = document.getElementById('simulate'); // 获取模拟到站按钮的元素
  let endPosition = document.getElementById('end-position'); // 获取结束位置的输入框的元素
  let delta = document.getElementById('delta');
  let status = document.getElementById('status');
  let distance = document.getElementById('distance');
  let station = document.getElementById('station'); // 获取站点的元素

  // 定义一些常量，用来表示像素和米，帧和秒之间的比例
  // 这些常量可以根据你的需要调整，但是要注意，如果比例太大或太小，可能会导致车辆的移动速度过快或过慢，或者超出屏幕的范围
  const PIXEL_TO_METER = 0.01; // 这里假设一个像素代表0.01米，即100像素代表1米
  const FRAME_TO_SECOND = 0.02; // 这里假设一帧代表0.02秒，即50帧代表1秒

  // 定义一些变量，用来表示车辆的速度，位移，自动模式，自动方向，自动停止功能，模拟到站功能，结束位置等
  let speedValue = 5; // 初始速度，可以根据需要调整
  let distanceValue = 0; // 初始位移，可以根据需要调整
  let autoMode = false; // 是否开启自动模式
  let autoDirection = 0; // 自动模式的方向，1表示加速，-1表示减速，0表示无
  let autoStopMode = false; // 是否开启自动停止功能
  let simulateMode = false; // 是否开启模拟到站功能
  let endPositionValue = 100; // 结束位置的路程长度，可以根据需要调整

  // 定义一个函数，用来更新速度输入框的值
  function updateSpeed() {
    speed.value = speedValue;
  }

  // 定义一个函数，用来更新路程长度的文本
  function updateDistance() {
    distance.textContent = '火车路程长度：' + distanceValue.toFixed(2) + ' 米';
  }

  // 定义一个函数，用来创建一个绿色的方形，并在方形上写上“站点”两个字
  function createStation() {
    // 创建一个div元素，用来表示站点
    let station = document.createElement('div');
    // 设置站点的id，方便后续操作
    station.id = 'station';
    // 设置站点的样式，包括宽度，高度，颜色，字体，隐藏等
    station.style.width = '50px';
    station.style.height = '50px';
    station.style.backgroundColor = 'lime';
    station.style.position = 'absolute';
    station.style.top = '50px';
    station.style.fontSize = '20px';
    station.style.textAlign = 'center';
    station.style.lineHeight = '50px';
    station.style.display = 'none';
    // 设置站点的内容，即“站点”两个字
    station.textContent = '站点';
    // 将站点添加到页面的body中
    document.body.appendChild(station);
    // 返回站点的元素
    return station;
  }

  // 定义一个函数，用来更新站点的位置，使其与结束位置对齐，并根据模拟到站功能的开启或关闭，显示或隐藏站点
  function updateStation() {
    // 根据结束位置的路程长度和比例，计算站点的左边距
    let leftPosition = endPositionValue / PIXEL_TO_METER;
    // 设置站点的左边距
    station.style.left = leftPosition + 'px';
    // 如果开启了模拟到站功能，就显示站点，否则就隐藏站点
    if (simulateMode) {
      station.style.display = 'block';
    } else {
      station.style.display = 'none';
    }
  }

  // 定义一个函数，用来根据物理公式，计算火车在模拟到站功能开启时的速度和位移
  function simulateStop() {
    // 如果开启了模拟到站功能，就根据物理公式，计算火车的速度和位移
    if (simulateMode) {
      // 获取结束位置的路程长度
      let end = endPositionValue;
      // 获取当前的路程长度
      let x = distanceValue;
      // 获取当前的速度
      let v = speedValue;
      // 获取每一帧的时间间隔
      let t = FRAME_TO_SECOND;
      // 计算火车的加速度，假设火车的加速度是恒定的，且与速度的方向相反
      let a = -v * Math.abs(v) / (end - x);
      // 计算火车在下一帧的速度
      let vNext = v + a * t;
      // 计算火车在下一帧的位移
      let xNext = x + v * t + 0.5 * a * t * t;
      // 如果火车的速度和位移都在合理的范围内，就更新速度和位移的值，否则就停止模拟到站功能，并将速度和位移设为结束位置的值
      if ((v > 0 && vNext >= 0 && x < end && xNext <= end) || (v < 0 && vNext <= 0 && x > end && xNext >= end)) {
        speedValue = vNext;
        distanceValue = xNext;
      } else {
        simulateMode = false;
        speedValue = 0;
        distanceValue = end;
      }
      // 更新速度输入框的值
      updateSpeed();
      // 更新路程长度的文本
      updateDistance();
    }
  }

  // 定义一个函数，用来移动车辆
  function moveCar() {
    // 根据速度值和比例，计算每一帧车辆移动的像素数
    let pixelPerFrame = speedValue * FRAME_TO_SECOND / PIXEL_TO_METER;
    let leftPosition = car.offsetLeft + pixelPerFrame;
    car.style.left = leftPosition + 'px';

    // 检查是否超出边界，这里简单处理，你可以根据需要调整
    if (leftPosition > window.innerWidth) {
      car.style.left = '0px';
    }

    // 更新路程长度，根据比例，将像素转换为米
    // 如果车辆向右移动，路程长度增加，如果车辆向左移动，路程长度减少
    distanceValue += pixelPerFrame * PIXEL_TO_METER;
    updateDistance();

    // 如果开启了自动模式，根据方向和幅度，改变速度值
    if (autoMode) {
      speedValue += autoDirection * Number(delta.value);
      // 限制速度的范围，避免速度过大或过小
      if (speedValue > 100) {
        speedValue = 100;
      }
      if (speedValue < -100) {
        speedValue = -100;
      }
      // 更新速度输入框的值
      updateSpeed();

      // 如果开启了自动停止功能，并且速度值在-0.5到0.5米/秒之间，就停止自动模式，并将方向设为无，并点击关闭按钮
      if (autoStopMode && speedValue >= -0.5 && speedValue <= 0.5) {
        autoMode = false;
        autoDirection = 0;
        status.textContent = '当前状态：无';
        stop.click(); // 调用关闭按钮
      }
    }

    // 如果开启了模拟到站功能，就调用模拟停止的函数，计算火车的速度和位移
    if (simulateMode) {
      simulateStop();
    }

    // 递归调用自身，实现动画效果
    requestAnimationFrame(moveCar);
  }

  // 启动车辆移动
  moveCar();

  // 可以通过修改speedValue变量来调整速度
  // 例如，将速度调整为10：speedValue = 10;

  // 添加一个事件监听器，当用户点击页面上的加速或刹车按钮时，改变速度
  increase.addEventListener('click', function() {
    speedValue += 1;
    // 限制速度的范围，避免速度过大或过小
    if (speedValue > 100) {
      speedValue = 100;
    }
    // 更新速度输入框的值
    updateSpeed();
  });

  decrease.addEventListener('click', function() {
    speedValue -= 1;
    // 限制速度的范围，避免速度过大或过小
    if (speedValue < -100) {
      speedValue = -100;
    }
    // 更新速度输入框的值
    updateSpeed();
  });

  // 添加一个事件监听器，当用户点击页面上的自动加速或自动减速按钮时，开启或切换自动模式，并改变方向
  autoIncrease.addEventListener('click', function() {
    // 如果当前是自动减速模式，就切换为自动加速模式
    if (autoMode && autoDirection == -1) {
      autoDirection = 1;
      status.textContent = '当前状态：自动加速';
    } else if (!autoMode) {
      // 否则，如果当前是无模式，就开启自动加速模式
      autoMode = true;
      autoDirection = 1;
      status.textContent = '当前状态：自动加速';
    }
  });

  autoDecrease.addEventListener('click', function() {
    // 如果当前是自动加速模式，就切换为自动减速模式
    if (autoMode && autoDirection == 1) {
      autoDirection = -1;
      status.textContent = '当前状态：自动减速';
    } else if (!autoMode) {
      // 否则，如果当前是无模式，就开启自动减速模式
      autoMode = true;
      autoDirection = -1;
      status.textContent = '当前状态：自动减速';
    }
  });

  // 添加一个事件监听器，当用户点击页面上的关闭按钮时，停止自动模式，并将方向设为无
  stop.addEventListener('click', function() {
    autoMode = false;
    autoDirection = 0;
    status.textContent = '当前状态：无';
  });

  // 添加一个事件监听器，当用户点击页面上的自动停止按钮时，开启或关闭自动停止功能
  autoStop.addEventListener('click', function() {
    // 如果当前是开启状态，就关闭自动停止功能，并将按钮颜色设为灰色
    if (autoStopMode) {
      autoStopMode = false;
      autoStop.classList.remove('on');
    } else {
      // 否则，就开启自动停止功能，并将按钮颜色设为绿色
      autoStopMode = true;
      autoStop.classList.add('on');
    }
  });

  // 添加一个事件监听器，当用户点击页面上的停止按钮时，直接把速度值设为0
  halt.addEventListener('click', function() {
    speedValue = 0;
    // 更新速度输入框的值
    updateSpeed();
  });

  // 添加一个事件监听器，当用户点击页面上的回位按钮时，直接把路程长度设为0，并将车辆位置重置
  reset.addEventListener('click', function() {
    distanceValue = 0;
    // 更新路程长度的文本
    updateDistance();
    // 将车辆位置重置为初始值
    car.style.left = '0px';
  });

  // 添加一个事件监听器，当用户点击页面上的模拟到站按钮时，开启或关闭模拟到站功能，并更新站点的位置
  simulate.addEventListener('click', function() {
    // 如果当前是开启状态，就关闭模拟到站功能，并将按钮颜色设为灰色
    if (simulateMode) {
      simulateMode = false;
      simulate.style.backgroundColor = 'gray';
    } else {
      // 否则，就开启模拟到站功能，并将按钮颜色设为绿色
      simulateMode = true;
      simulate.style.backgroundColor = 'lime';
    }
    // 更新站点的位置
    updateStation();
  });

  // 添加一个事件监听器，当用户修改页面上的结束位置的输入框时，更新结束位置的值，并更新站点的位置
  endPosition.addEventListener('change', function() {
    // 获取结束位置的输入框的值
    endPositionValue = Number(endPosition.value);
    // 更新站点的位置
    updateStation();
  });

</script>

</body>
</html>